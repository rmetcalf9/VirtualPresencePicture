version: '1.0'
steps:
  test_all_the_code:
    image: metcarob/docker-ws-caller:0.2.5
    working_directory: ${{main_clone}}/server
    commands:
      - pip3 install -r ./src/requirements.txt
      - pip3 install -r ./testContainer/requirements.txt
      - nosetests --rednose ./test

  build_the_image:
    working_directory: ${{main_clone}}/server
    type: build
    image_name: metcarob/virtualpresencepicture
    tag: develop

  build_the_test_image:
    working_directory: ${{main_clone}}/server/testContainer
    type: build
    image_name: metcarob/virtualpresencepicturetest
    tag: develop
    dockerfile: ./Dockerfile

  container_level_tests:
    type: composition
    title: Container level tests
    composition:
      virtualpresencepicture:
        image: ${{build_the_image}}
    composition_candidates:
      virtualpresencepicturetest:
        image: ${{build_the_test_image}}
        command: nosetests --rednose /ext_volume

    